!function(a){"use strict";a(function(){var r=!1;function e(r){a("#wc-pagseguro_assinaturas-cc-form").attr("data-credit-card-brand",r)}function s(r){var e=a("#wc-pagseguro_assinaturas-cc-form");a(".woocommerce-error",e).remove(),e.prepend('<div class="woocommerce-error" style="margin-bottom: 0.5em !important;">'+r+"</div>")}function n(){a("#wc-pagseguro_assinaturas-cc-form").show(),a("#pagseguro_assinaturas_card_holder_cpf").mask("000.000.000-00"),a("#pagseguro_assinaturas_card_holder_birth_date").mask("00/00/0000");var r=function(a){return 11===a.replace(/\D/g,"").length?"(00) 00000-0000":"(00) 0000-00009"},e={onKeyPress:function(a,e,s,n){s.mask(r.apply({},arguments),n)}};a("#pagseguro_assinaturas_card_holder_phone").mask(r,e)}function t(){if(r)return r=!1,!0;if(!a("#payment_method_pagseguro_assinaturas").is(":checked"))return!0;var e=a("form.checkout, form#order_review, form#add_payment_method"),n=!1,t="",o=a("#wc-pagseguro_assinaturas-cc-form",e).attr("data-credit-card-brand"),u=a("#pagseguro_assinaturas-card-number",e).val().replace(/[^\d]/g,""),i=a("#pagseguro_assinaturas-card-cvc",e).val(),c=a("#pagseguro_assinaturas-card-expiry",e).val().replace(/[^\d]/g,"").substr(0,2),d=a("#pagseguro_assinaturas-card-expiry",e).val().replace(/[^\d]/g,"").substr(2),g=new Date;if(t+="<ul>",void 0!==o&&"error"!==o||(t+="<li>"+wc_pagseguro_assinatura_params.invalid_card+"</li>",n=!0),2===d.length){var _=g.getFullYear().toString().substr(0,2);d=_+""+d}return 2===c.length&&4===d.length||(t+="<li>"+wc_pagseguro_assinatura_params.invalid_expiry+"</li>",n=!0),2===c.length&&4===d.length&&(c>12||d<=g.getFullYear()-1||d>=g.getFullYear()+20||c<g.getMonth()+2&&d.toString()===g.getFullYear().toString())&&(t+="<li>"+wc_pagseguro_assinatura_params.expired_date+"</li>",n=!0),t+="</ul>",n?s(t):PagSeguroDirectPayment.onSenderHashReady(function(n){if("error"==n.status)return pagSeguroAddErrorMessage(n.message),!1;PagSeguroDirectPayment.createCardToken({brand:o,cardNumber:u,cvv:i,expirationMonth:c,expirationYear:d,success:function(s){a("input[name=pagseguro_assinaturas_credit_card_hash]",e).remove(),e.append(a('<input name="pagseguro_assinaturas_credit_card_hash" type="hidden" />').val(s.card.token)),e.append(a('<input name="pagseguro_assinaturas_sender_hash" type="hidden" />').val(n.senderHash));var t=u.substr(u.length-4);e.append(a('<input name="pagseguro_assinaturas_last4" type="hidden" />').val(t)),e.append(a('<input name="pagseguro_assinaturas_brand" type="hidden" />').val(o)),e.append(a('<input name="pagseguro_assinaturas_exp_month" type="hidden" />').val(c)),e.append(a('<input name="pagseguro_assinaturas_exp_year" type="hidden" />').val(d)),r=!0,e.submit()},error:function(){s(wc_pagseguro_assinatura_params.general_error)}})}),!1}wc_pagseguro_assinatura_params.session_id?(PagSeguroDirectPayment.setSessionId(wc_pagseguro_assinatura_params.session_id),"undefined"!=typeof wc_checkout_params&&"1"===wc_checkout_params.is_checkout?a("body").on("updated_checkout",function(){n()}):n(),a("body").on("focusout","#pagseguro_assinaturas-card-number",function(){var r=a(this).val().replace(/[^\d]/g,"").substr(0,6);6===r.length&&PagSeguroDirectPayment.getBrand({cardBin:r,success:function(r){a("body").trigger("pagseguro_assinaturas_credit_card_brand",r.brand.name),e(r.brand.name)},error:function(){a("body").trigger("pagseguro_assinaturas_credit_card_brand","error"),e("error")}})}),a("body").on("updated_checkout",function(){var r=a("body #pagseguro_assinaturas-card-number");0<r.length&&r.focusout()}),a("body").on("focus","#pagseguro_assinaturas-card-number, #pagseguro_assinaturas-card-expiry",function(){a("#wc-pagseguro_assinaturas-cc-form .woocommerce-error").remove()}),a("body").on("pagseguro_assinaturas_credit_card_brand",function(a,r){"error"==r&&s(wc_pagseguro_assinatura_params.invalid_card)}),a("form.checkout").on("checkout_place_order_pagseguro_assinaturas",function(){return t()}),a("form#order_review").submit(function(){return t()}),a("form#add_payment_method").submit(function(){return t()})):a("body").on("updated_checkout",function(){a("#wc-pagseguro_assinaturas-cc-form").remove()})})}(jQuery);